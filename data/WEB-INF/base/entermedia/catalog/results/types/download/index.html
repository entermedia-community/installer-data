<script type="text/javascript" src="$home/${applicationid}/tools/album/download/download.js"></script>
$context.putPageValue("showactions", true)
$context.putPageValue("showselections", false)
$pages.include("${themeprefix}/layouts/resultsheader.html", $context)
<div id="resultscontent_$catalogid">
	$pages.include("$cataloghome/results/actionsmenu.html", $context)
	#if(!$album)
		$pages.include("${cataloghome}/results/navigate/navigate.html", $context)
	#end
	#if ($hits && $hits.size() > 0)
		<form method="post" id="selectionForm${catalogid}">
		<input type="hidden" name="catalogid" value="$!catalogid"/>
		<input type="hidden" name="field" value="Venue"/>
		<input id="${catalogid}_venueval" type="hidden" name="Venue.value" value=""/>
	#end
	<a id="fancylink" class="hidden" href="/redesign/sfcreative/index.html"></a>
	<table cellpadding=0 cellspacing=0 border=0 width="100%" class="striped emdownloadlisting">
		<tr>
			<th style="width: 55px;">[[Select]]</th>
			<th>[[Image]]</th>
			<th>[[Download Size]]</th>
			<th>[[Download]]</th>
		</tr>  
		#if ( $hits && $hits.size() > 0 )
			#set( $even = false )
			#foreach( $hit in $hits.getPageOfHits() )
			    #set( $asset = $mediaarchive.getAssetBySourcePath($hit.sourcepath))
				$context.putPageValue("asset", $asset)
				$context.setRequestParameter("sourcepath", $asset.sourcepath)	
				#if( $even )
					#set( $even = false )
				#else
					#set( $even = true )
				#end
				$context.putPageValue( "even",$even )
				
				$pages.include("${cataloghome}/results/types/download/row.html", $context)
			#end
		#end
	</table>


	#if ($hits && $hits.size() > 0)
		</form>  
	#end
</div>	


<script type="text/javascript">

	selectAll = function(catalog)
	{
		return setAllSelections(catalog, true);
	}

	selectNone = function(catalog)
	{
		return setAllSelections(catalog, false);
	}

	setAllSelections = function(catalog, selected)
	{
		var checkboxes = document.getElementsByName('assetselect_' + catalog);
		for (i = 0; i < checkboxes.length; i++)
		{
			checkboxes[i].checked = selected;
		}
		updateCheckBoxCounter(catalog);
		return false;
	}

	function setWidthHeightExtension(catalogid, assetid, inValue)
	{
		wid = document.getElementById(catalogid + "." + assetid + '.width');
		ext = document.getElementById(catalogid + "." + assetid + '.extension');
		wid.value=inValue;
		ext.value = "jpg";
	}
	downloadSelection = function(catalogid)
	{
		if(checkForSelection(catalogid) > 0)
		{
			var linkstring = '$home/' + catalogid + '/downloads/history/downloadzip.html?iframe=true&height=200&width=400';
			var formid = '#selectionForm' + catalogid;
			formid = formid.replace(/\//g, "\\/");
			var form = jQuery(formid+ " input");
			var addtext = true;
			for(i=0;i<form.size();i++)
			{
				var input = form[i];
				if(input.type == "checkbox")
				{
					if(input.checked)
					{
						addtext=true;
					}
					else
					{
						addtext=false;
					}
				}
				if(addtext)
				{
					if(input.value)
					{
						linkstring = linkstring + "&" + input.name + "=" + input.value;
					} 
				}
			}
			var link = jQuery("#fancylink");
			link.attr("href", linkstring);
			link.fancybox().click();
			return false;
		}
		else
		{
			alert("No items are selected.");
			return false;
		}
	}	

	downloadSingleFile = function(catalogid, assetid)
	{
		var linkstring = '$home/' + catalogid + '/downloads/history/downloadform.html?catalogid=' + catalogid;
		//linkstring = linkstring + "&assetselect_" + catalogid + "=" + assetid;
		linkstring += "&assetid=" + assetid;
		
		//TODO: Need to pass in the size they selected

		var width, extension;
		width = document.getElementById(catalogid+'.'+assetid+'.width').value;
		extension = document.getElementById(catalogid+'.'+assetid+'.extension').value;
		linkstring += "&size.width=" + width;
		linkstring += "&height=200&width=400"; //iframe size
		linkstring += "&extension=" + extension;
		var link = jQuery("#fancylink");
		link.attr("href", linkstring);
		link.fancybox().click();
		return false;
	}
		
	checkForSelection = function(catalog)
	{
		var checkboxes = document.getElementsByName('assetselect_' + catalog);
		var counter = 0;
		for (i = 0; i < checkboxes.length; i++)
		{
			if(checkboxes[i].checked)
			{
				counter++;
			}
		}
		return counter;
	}

	printSelection = function(catalogid)
	{
		var form = document.getElementById('selectionForm' + catalogid);
		var oldaction = form.action;
		form.action = '$home$cataloghome/print/index.html';
		form.target = '_blank';
		form.submit();
		form.action = oldaction;
		return false;
	}
	
	sendSelection = function(catalogid)
	{
		var form = document.getElementById('selectionForm' + catalogid);
		var oldaction = form.action;
		form.action = '$home$cataloghome/send/index.html';
		form.submit();
		form.action = oldaction;
		return false;
	}
	
	updateCheckBoxCounter = function(catalog)
	{
		var checkboxes = document.getElementsByName('assetselect_' + catalog);
		var counter = 0;
		for (i = 0; i < checkboxes.length; i++)
		{
			if(checkboxes[i].checked)
			{
				counter++;
			}
		}
		new Ajax.Updater('actionsmenusection', '${home}/${cataloghome}/results/actionsmenuhead.html', 
				{ parameters: {
					checkBoxCount: counter,
					catalogid: catalog,
					oemaxlevel: '1',
					menuid: catalog + 'actions'
				}});
		return false;
		
	}
	
	addComment = function(catalogid, assetid, sourcepath, text)
	{
		new Ajax.Updater('downloadcommentsection_' + catalogid + '_' + assetid,
				'$home$cataloghome/results/types/download/savecomment.html',
				{ parameters: {
					catalogid: catalogid,
					assetid: assetid,
					sourcepath: sourcepath,
					comment: text,
					oemaxlevel: 1
				}});
	}
</script>
	