#set( $assetrootfolder = $context.findValue("assetrootfolder" ) )
#set( $listsearcher = $mediaarchive.getSearcherManager().getSearcher($mediaarchive.catalogId,'datatype') )
$context.putPageValue("listsearcher", $listsearcher)
$context.putPageValue("assetrootfolder", $assetrootfolder)

<h2>[[Related Items]]</h2>

#if( $relatedhits.size() == 0 )
	<p>No related items found</p> <br><br>
#else
<table class="emdarktable" width="100%" style="padding-left:20px; border: 0px;">
<tr>
	<th>[[Details]]</th>
	<th>[[Image]]</th>
	<th>[[Item Number]]</th>
	<th>[[Relationship]]</th>
	<th>[[Item Title]]</th>
	#if( $canrelateassets )
	<th>[[Remove Relationship]]</th>
	<!-- $!context.setRequestParameter("showremove","true") -->
	#end
</tr>

#foreach($hit in $relatedhits)
	#set($relation = $matt.getAsset($hit.relatedToCatalogId, $hit.relatedToAssetId))
	$context.putPageValue("hit", $hit)
	$context.putPageValue("relation", $relation)
	#set( $mediaarchive = $matt.getStore($hit.relatedToCatalogId))
	$context.putPageValue("mediaarchive", $mediaarchive)
	$context.putPageValue("assetrootfolder", "/$hit.relatedToCatalogId/assets")
	
	$pages.include("./sublist.html", $context)
#end

</table>
#end

#set( $copy = "${page.directory}/create.html" )
#set( $relate = "/${applicationid}/tools/relate/index.html" )
#set( $multiedit = "/${applicationid}/tools/edit/index.html" )

#if( $pages.canView($copy) || $pages.canView($relate) )
<p>Actions:
	<ul>
	#if( $pages.canView($copy) ) 
		<li><a href="$home$copy?assetid=$asset.id&editPath=$cataloghome/data/originals/$asset.sourcePath">[[Copy and Relate]]</a> [[a new item]]</li>
	#end
	#if( $canrelateassets ) 
		<li><a href="$home$relate?assetid=$asset.id&catalogid=${catalogid}&origURL=$cataloghome/assetdetails/relatedassets/index.html?assetid=$asset.id">[[Create relationship]]</a> [[to an existing item]].</a></b></li>
	#end
	#if ($pages.canView($multiedit))
		<li><a href="$home$multiedit?hitsname=$allrelatedhits.sessionId">[[Multi Edit]]</a> all related assets</a></b></li>
	#end
	</ul>
</p>
#end